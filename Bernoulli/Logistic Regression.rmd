---
title: "Logistic Regression"
output:
  html_document:
    df_print: paged
---

## Association between beehive cell and the prevalence of ectoparasite *Varoa destructor*

*Varoa destructor* is an ectoparasite and reproduces in closed beehive cells.

I will analyze if the size of the beehive cell is associated with the invasive nature of *V.destructor* in natural conditions. 

The presence or abscence of parasites in 917 cells was counted and the width of the cells were also measured. 

```{r echo = TRUE}
#the presence or abscence is a dicotomic response variable. 
parasites = c(
  1,  0,  0,  1,  1,  0,  1,  1,  0,  1,  0,  0,  0,  1,  0,
  1,  1,  1,  0,  0,  1,  1,  1,  0,  0,  1,  1,  1,  1,  0,
  1,  0,  1,  1,  1,  1,  1,  1,  0,  0,  0,  1,  0,  1,  0,
  0,  0,  1,  1,  1,  1,  0,  1,  0,  0,  1,  0,  1,  1,  0,
  1,  0,  0,  1,  1,  0,  0,  1,  0,  0,  0,  0,  0,  1,  0,
  1,  1,  1,  1,  1,  0,  1,  1,  1,  1,  1,  1,  1,  1,  0,
  1,  0,  1,  0,  0,  0,  0,  1,  1,  0,  0,  1,  1,  0,  0,
  0,  1,  1,  0,  1,  1,  1,  1,  0,  0,  1,  0,  1,  1,  1,
  1,  1,  1,  1,  0,  0,  0,  1,  1,  1,  0,  0,  1,  0,  0,
  0,  0,  1,  0,  1,  1,  1,  1,  0,  1,  1,  0,  1,  0,  0,
  0,  1,  1,  1,  0,  1,  1,  1,  1,  0,  0,  1,  1,  0,  0,
  1,  1,  0,  1,  0,  0,  0,  1,  1,  0,  0,  0,  1,  1,  0,
  0,  0,  1,  1,  0,  1,  0,  0,  0,  1,  1,  0,  1,  0,  0,
  0,  0,  1,  0,  1,  1,  0,  1,  1,  0,  1,  0,  1,  1,  1,
  1,  0,  1,  1,  0,  0,  1,  1,  0,  0,  1,  0,  1,  0,  1,
  1,  1,  0,  1,  0,  1,  0,  1,  0,  1,  1,  1,  1,  0,  0,
  1,  0,  0,  1,  1,  0,  1,  0,  0,  1,  1,  0,  0,  1,  1,
  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
  1,  1,  1,  1,  1,  1,  0,  0,  1,  1,  1,  1,  1,  0,  1,
  0,  1,  1,  1,  1,  0,  1,  0,  1,  1,  1,  0,  1,  0,  1,
  0,  0,  1,  0,  0,  0,  0,  0,  0,  1,  0,  0,  1,  1,  0,
  1,  0,  1,  1,  1,  1,  0,  1,  0,  1,  0,  1,  1,  0,  1,
  1,  1,  1,  0,  0,  0,  0,  0,  0,  0,  1,  1,  0,  0,  1,
  1,  0,  1,  1,  1,  1,  0,  1,  1,  1,  1,  1,  1,  0,  0,
  0,  1,  0,  1,  1,  0,  1,  0,  1,  0,  1,  0,  1,  1,  1,
  1,  0,  1,  1,  1,  1,  1,  1,  1,  1,  0,  1,  0,  1,  0,
  0,  1,  0,  1,  1,  0,  1,  0,  1,  0,  1,  1,  0,  1,  0,
  0,  1,  1,  1,  0,  1,  1,  1,  0,  0,  0,  0,  0,  0,  1,
  0,  1,  0,  0,  1,  0,  0,  1,  1,  1,  1,  1,  0,  1,  1,
  1,  0,  1,  1,  1,  0,  0,  0,  0,  1,  1,  0,  0,  1,  1,
  1,  0,  0,  1,  0,  0,  1,  1,  0,  0,  0,  0,  0,  1,  1,
  1,  0,  0,  0,  1,  0,  0,  0,  1,  1,  1,  1,  1,  1,  1,
  1,  0,  0,  1,  0,  0,  1,  0,  1,  0,  0,  0,  0,  0,  1,
  0,  1,  0,  1,  0,  0,  0,  1,  1,  0,  1,  1,  1,  1,  0,
  1,  1,  0,  1,  0,  0,  0,  0,  1,  1,  1,  1,  1,  0,  0,
  1,  1,  0,  1,  0,  0,  0,  0,  1,  0,  1,  1,  1,  1,  1,
  1,  0,  1,  1,  1,  1,  1,  0,  1,  1,  0,  1,  1,  0,  1,
  1,  0,  0,  1,  0,  0,  1,  0,  1,  1,  1,  1,  0,  1,  0,
  0,  1,  1,  1,  0,  0,  0,  0,  1,  1,  0,  0,  0,  0,  1,
  0,  0,  0,  1,  0,  0,  0,  1,  0,  1,  0,  1,  1,  0,  0,
  1,  0,  0,  1,  0,  1,  0,  1,  1,  1,  0,  0,  0,  0,  1,
  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  0,  1,  1,  0,  1,
  0,  1,  0,  0,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,  1,
  1,  1,  0,  0,  0,  1,  0,  1,  0,  0,  0,  0,  1,  0,  1,
  1,  0,  1,  1,  0,  1,  0,  0,  0,  0,  1,  0,  0,  1,  1,
  0,  1,  0,  0,  1,  0,  1,  0,  1,  0,  0,  1,  1,  1,  0,
  1,  0,  0,  1,  0,  1,  0,  1,  0,  0,  0,  1,  0,  1,  1,
  0,  1,  1,  1,  0,  1,  0,  0,  0,  1,  1,  1,  0,  0,  1,
  1,  0,  1,  1,  1,  1,  0,  0,  0,  1,  0,  1,  1,  0,  1,
  1,  0,  0,  1,  0,  1,  1,  0,  0,  1,  0,  1,  1,  1,  0,
  0,  1,  0,  0,  1,  1,  0,  0,  0,  0,  0,  0,  1,  0,  1,
  1,  1,  1,  1,  0,  0,  0,  1,  1,  1,  0,  0,  1,  0,  0,
  0,  1,  0,  1,  0,  0,  1,  1,  1,  0,  0,  0,  0,  0,  1,
  1,  1,  0,  0,  1,  1,  0,  1,  0,  1,  0,  1,  1,  0,  0,
  0,  1,  0,  1,  1,  1,  0,  0,  0,  1,  1,  1,  1,  1,  1,
  0,  1,  0,  0,  0,  1,  1,  1,  0,  0,  1,  0,  1,  1,  1,
  0,  1,  1,  0,  0,  1,  0,  1,  1,  1,  0,  1,  1,  1,  0,
  0,  1,  0,  1,  1,  0,  1,  0,  1,  1,  0,  1,  1,  1,  0,
  1,  0,  1,  0,  1,  1,  1,  0,  0,  0,  0,  1,  1,  0,  1,
  0,  0,  0,  1,  1,  1,  0,  1,  0,  1,  1,  1,  0,  1,  1,
  1,  0,  1,  0,  1,  1,  1,  1,  1,  1,  1,  1,  0,  1,  1,
  1,  1
)
# Width is a continuos Explanatory Variable
width = c(
  5.16,  5.23,  5,  5.72,  5.5,  5.63,  5.04,  5.89,  5.12,  5.15,
  4.57,  4.71,  5.4,  5.35,  5,  5.35,  5.49,  5.35,  4.96,  4.9,
  6.08,  4.77,  5.61,  5.05,  5.07,  5.39,  4.5,  5.4,  5.35,  5,
  5.19,  4.66,  5.4,  5.23,  4.76,  5.06,  5.14,  5.39,  5.58,  5.21,
  5.02,  5.15,  5.35,  5.57,  4.56,  5.18,  5.15,  5.37,  5.5,  4.98,
  6.64,  5.11,  4.98,  4.16,  5.63,  5.55,  4.93,  5.71,  6.37,  5.24,
  5.58,  5.05,  5.08,  5.39,  5.36,  6.39,  5.36,  5.91,  4.24,  4.72,
  4.9,  5.41,  5,  5.67,  4.9,  5.54,  5.52,  5.55,  5.96,  5.55,  5.02,
  5.64,  5.07,  4.82,  5.18,  5.07,  5.64,  5.47,  5.57,  4.07,  5.13,
  4.69,  4.71,  4.96,  5.25,  4.69,  5.05,  5.42,  5.4,  4.86,  5.4,  5.4,
  5.39,  4.66,  5.12,  4.55,  5.09,  4.96,  5.08,  5.33,  4.93,  5.61,
  5.1,  4.85,  5.05,  4.94,  4.46,  5.04,  5.21,  5.15,  5.14,  5.96,  5.77,
  4.79,  4.96,  4.61,  4.82,  5.25,  5.07,  5.18,  4.82,  5.26,  5.61,  5.43,
  5.69,  5.5,  5.26,  5.18,  5.55,  5.26,  5.57,  5.36,  5.35,  5.43,  5.93,
  5.11,  4.77,  5.72,  4.69,  4.69,  5.47,  5.2,  5.57,  5.2,  5.05,  5.38,
  5.91,  4.82,  6,  5.43,  5.75,  5.46,  5.66,  5.11,  5.4,  4.94,  5.36,
  5.5,  5.26,  4.94,  5.55,  5.4,  5.58,  6.06,  5.36,  5.11,  5.05,  5.42,
  5.29,  6.11,  5.22,  5.33,  5.4,  5.46,  4.74,  4.9,  5,  5.69,  4.96,  5.17,
  5.16,  5,  5.46,  4.92,  4.57,  4.85,  5.2,  5.43,  5.65,  4.99,  5.38,
  4.75,  5.67,  4.92,  5.18,  5.36,  4.86,  5.59,  5.1,  4.46,  5.52,  4.18,
  4.46,  5.16,  4.96,  5.4,  5.76,  4.6,  5.7,  4.86,  5.94,  5.25,  4.98,
  5.16,  5.05,  6.46,  5.67,  5,  5.04,  5.9,  5.7,  4.71,  5.34,  5.45,
  5.48,  5.74,  6.14,  6.14,  4.86,  4.81,  5.85,  5.55,  4.79,  5.2,  4.95,
  5.11,  5.2,  4.86,  4.9,  5.15,  4.77,  4.87,  4.82,  5.61,  5.26,  5.15,
  4.57,  5.48,  5.03,  5.07,  5.08,  5.52,  5.22,  5.23,  5.66,  5.77,  4.86,
  4.92,  5.7,  4.9,  5.5,  5.96,  5.2,  5.43,  5.5,  5.33,  4.86,  4.07,
  5.72,  5.17,  5.46,  5.1,  5.35,  4.46,  5.54,  4.96,  5.35,  5.16,  5.42,
  5.49,  4.41,  4.99,  4.92,  5.52,  5.04,  5.52,  4.9,  5,  4.96,  5.3,  4.61,
  4.56,  5.23,  4.96,  4.66,  5.36,  4.46,  4.07,  4.46,  5.76,  4.77,  5.18,
  5.18,  4.9,  4.96,  5.07,  4.75,  5.57,  5.48,  4.39,  4.85,  4.32,  5.31,
  4.87,  5.5,  5.45,  5.59,  5.83,  4.87,  5.12,  5.5,  5.39,  5.83,  5.45,
  5.06,  5,  4.96,  5.18,  5.16,  4.31,  4.74,  4.94,  5.18,  5.36,  5.4,
  4.89,  4.83,  5.91,  5.15,  5.54,  5,  5.19,  5.08,  5.64,  5.05,  5.39,
  5.37,  4.8,  4.51,  5,  4.99,  5.64,  4.79,  4.8,  4.73,  5.05,  5,  5.44,
  5.29,  5.55,  5.24,  4.94,  5.2,  5.91,  5.26,  4.98,  5.07,  6.3,  5.58,
  5.33,  5.23,  5.42,  4.9,  5.48,  5.16,  4.94,  5.22,  5.4,  4.87,  5.22,
  5.15,  5.1,  5.06,  5.01,  4.93,  4.61,  5.96,  4.68,  5.14,  5.22,  5.37,
  5,  4.35,  6.11,  5.59,  4.87,  4.98,  5.72,  5.07,  3.93,  6.07,  5.96,
  5.36,  5.55,  4.9,  5.64,  5.19,  4.17,  5.55,  5.88,  5.27,  4.8,  5.81,
  4.51,  5.57,  5.36,  5.52,  5.26,  5.33,  5.13,  5.2,  5.49,  5.3,  4.95,
  5.42,  5.08,  5.11,  5.73,  6.32,  5.23,  5.21,  4.71,  4.91,  5.33,  5.33,
  5.18,  5.11,  5,  6.06,  4.97,  5.4,  5.74,  4.82,  5.07,  4.46,  4.83,
  4.62,  5.49,  4.89,  4.26,  5.47,  4.7,  5.58,  5.54,  5.71,  5.15,  5.18,
  5.25,  5.83,  6.37,  5.11,  4.68,  5.48,  5.14,  5.14,  5.01,  5,  4.92,
  5.14,  5.15,  5.03,  5.01,  5.4,  5.64,  3.93,  5.2,  5.73,  4.63,  5.32,
  5.72,  4.59,  5.04,  4.69,  5.5,  5.72,  5.55,  5.25,  5.21,  5.14,  5.4,
  4.61,  5.11,  5.42,  5.37,  5.12,  5.37,  5.18,  5.59,  5,  6.32,  5.46,
  4.98,  4.96,  5.27,  5.72,  5.49,  5.07,  4.41,  5.54,  5.3,  5.4,  5.09,
  6.06,  5.44,  4.61,  5.72,  4.94,  4.51,  5.37,  5.11,  5.19,  5.25,  3.96,
  5.29,  4.82,  4.61,  5.87,  5.67,  5.63,  4.41,  5.01,  4.79,  4.7,  5.36,
  5.43,  5.83,  5.2,  5.11,  5.52,  6.26,  4.67,  5.48,  4.68,  4.32,  6.06,
  5.22,  4.71,  4.94,  5.88,  5.5,  5.33,  4.9,  4.21,  5.35,  5.25,  4.8,
  4.89,  5,  6.26,  4.3,  5.25,  5.67,  5.29,  5.1,  4.46,  5.01,  5.98,
  4.61,  5.39,  5.26,  5.15,  4.81,  4.85,  4.82,  5.46,  5.5,  5.11,  4.9,
  6.37,  4.86,  5.05,  5.28,  5.52,  4.83,  5.3,  5.16,  4.93,  5.55,  4.8,
  4.96,  5.58,  5.22,  4.18,  5.62,  5.11,  5.07,  4.44,  5.47,  5.41,  5.34,
  4.8,  4.07,  5.22,  5.64,  5.8,  4.67,  5.23,  5.03,  5.17,  4.85,  5.98,
  5.39,  5.7,  4.93,  5.98,  5.15,  5.47,  5.5,  5.36,  5.66,  4.76,  6.06,
  4.21,  4.26,  5.93,  5.96,  5.55,  5.71,  5.15,  5.46,  5.15,  5.77,  4.42,  5.7,
  5.5,  5.55,  5.24,  5.05,  4.72,  4.94,  4.72,  5.28,  5.08,  5.04,  4.85,
  4.89,  5.81,  4.52,  4.48,  4.9,  4.74,  4.71,  4.48,  5.35,  4.74,  5.4,
  4.61,  4.77,  5.5,  3.96,  5.02,  4.86,  4.85,  5.49,  5.23,  4.66,  4.85,
  5.13,  4.61,  5.54,  5.4,  5.65,  4.86,  5.14,  5.25,  5.31,  5.36,  4.85,
  5.43,  5.13,  5.67,  5.3,  4.51,  5.48,  5,  5.48,  3.93,  5.58,  5.31,
  4.42,  5.2,  5.26,  5.4,  5.35,  5.14,  5.16,  4.97,  5.11,  5.5,  4.18,  5.64,
  5.32,  5,  5.13,  5.72,  5.14,  5.42,  5.09,  4.85,  5.64,  5.5,  5.01,
  4.59,  4.96,  5.46,  5.7,  5.98,  5.85,  5.97,  5.74,  5.25,  5.22,  5.23,
  4.46,  5.42,  5.7,  4.16,  4.6,  5.85,  4.57,  4.68,  5.5,  4.26,  4.83,
  5,  5.11,  5.22,  5.2,  5.09,  4.96,  5.4,  5.4,  5.15,  5.3,  5.21,  5.28,
  4.26,  4.86,  5.18,  5.7,  5.69,  5.56,  5.65,  4.79,  4.8,  4.78,  5.18,
  6.37,  5.89,  5.11,  4.82,  4.82,  4.8,  5.15,  5.36,  4.71,  4.9,  5.37,
  4.55,  4.98,  4.42,  5.42,  4.96,  5.87,  4.71,  5.4,  5.55,  5.15,  6.14,
  4.89,  5.4,  4.07,  4.9,  4.66,  5.23,  5.18,  5.72,  5.5,  4.59,  5.29,
  4.92,  5.3,  5.26,  5.15,  5.35,  4.93,  5.61,  5.7,  4.96,  5.26,  4.86,
  5.64,  5.18,  5.2,  5.24,  5.48,  4.87,  5.04,  5.11,  6.06,  5.29,  5.03,
  5.25,  4.7,  5.15,  4.29,  4.93,  5.05,  4.68,  5.05,  5.75,  5.54,  5.73,
  5.3,  4.66,  5.58,  5.22,  5.08,  5.67,  5.28,  4.82,  5.12,  5.64,  4.86,
  4.86,  5.22,  5.55,  5.07,  5.18,  5.7,  4.9,  5.72,  5.79,  5.13,  5.3,
  5.08,  4.8,  4.93,  4.96,  5.14,  4.54,  4.76,  5.22,  6.04,  4.35,  4.9,
  4.74,  4.52,  4.74,  5.01,  3.52,  5.55,  5.34,  4.75,  5.71,  4.77,  5.26,
  5.55,  5.11,  4.57,  5.16,  5.4,  5.82,  4.66,  5.22,  5.3,  4.73,  5.4,
  5.4,  5.59,  5.08,  4.96,  6.06,  4.61,  5.76,  5.64,  5.64,  4.67,  5.07,
  5.41,  5.14,  4.9,  4.98,  5.47,  5.49,  5.5,  5.58,  6.18,  5.37,  5.73,
  5.3,  4.85,  4.69,  4.95,  5.15,  5.43,  5.08
)

beeHive = data.frame(parasites, width)
```
```{r echo = TRUE, warning = FALSE, message = FALSE}
#Libraries used
library(sjPlot)
library(ggplot2)
library(ResourceSelection)
library(ggpubr)
```

Firstly I will see what the prevalence of parasites is:

```{r echo = TRUE}
table(beeHive$parasites)
```

so: 

```{r echo = TRUE}

510/(407+510)

```

And apparently there is a 55% prevalence, or Success rate. Seeing that the success rate is higher than 50/50 it makes sense to see how the width of the cells is distributed:

```{r echo = TRUE}
beeHist = ggplot() +
  geom_histogram(data = beeHive, 
                 aes(x = width), 
                 binwidth = .09,
                 colour = "gold2",
                 fill = "darkmagenta") +
  labs(x = "Cell Width (mm)")
beeHist
```

At a glance, the cell width seems to predominate between 4.8 and 5.6. 

Now to see if the width has anything to do with the prevalance!

First I will define my model:

Probability for success is: P(Y = 1) = $\pi$
Probability for failure: P(Y = 0) = 1-$\pi$

The hope for Response Variable: $E$[Y$_i$] = $\mu$$_i$ = $\pi$

The variance of this distribution is: $\pi$(1-$\pi$).

Response Variable: $Y$$_i$ = Presence/Abscence of **V.desructor in a cell (Bernoulli distribution (binomial))

Link function and relationship to odds

$\eta$$_i$ = $\beta$$_0$ + $\beta$$_1$*Width

$\eta$$_i$ $=$ logit($\pi$$_i$) = ln$(\frac{\pi}{1-\pi})$ $=$ ln($odds$$_i$)

Odds Scale

$odds_i$ = $\frac{\pi_{i}}{1-\pi_{i}}$ $=$ $e$$^{\eta_{i}}$ $=$ $e$$^{\beta_{0} + \beta_{1}*Width}$

Finally, the Response Variable Scale is:

$E$($Y$$_{i}$) $=$ $\pi$$_{i}$ $=$ $\frac{e^\eta{_{i}}}{1 + e^\eta{_{i}}}$ $=$ $\frac{e^\beta{_{0}}+^\beta{_{1}}*Width}{1 + e^\beta{_{0}}+^\beta{_{1}}*Width}$

The model proposed to explain the data is:

```{r echo = TRUE}
model1 = glm(parasites ~ width, data = beeHive, family = binomial)
```
```{r echo = TRUE}
summary(model1)
```

Analyzing the residues when the data takes on values between 0 & 1 aren't informative. Since the variable is dicotomic in nature there isn't a possibility to observe over or under dispersion.

How can we be sure if the model is informative?

We can conduct Hosmer-Lemeshow's goodness of fit test for the model:

```{r echo = TRUE}
hoslem.test(parasites, fitted(model1), g = 10)
```

Since p-value > 0.05 there is no reason to reject the null hypothesis; $H$$_{0}$: The proposed model fits well to the data.

With no evidence suggesting the model doesn't fit correctly to the data I can continue analyzing the data.
The predictions for the model:

```{r echo = TRUE, warning=FALSE, message=FALSE}
LP = predict(model1, type = "link") #LOGIT scale
odds = exp(LP) #ODDS scale
pred = predict(model1, type = "response") #RV scale

beeHive = as.data.frame(cbind(width, parasites, round(LP,2),
                              round(LP,2),
                              round(odds,2),
                              round(pred,2)))
colnames(beeHive) = c("width", "parasites", "Linear.Predictor",
                      "Odds", "Predicted Probability")

LinPred = ggplot() +
  geom_point(data = beeHive, aes(x = width, y = LP),
             colour = "gold2")

OddsPred = ggplot() +
  geom_point(data = beeHive, aes(x = width, y = odds),
             colour = "gold2")

range(width)
new_beeHive = data.frame(width = seq(3.5, 6.6, length = 50))
new_beeHive$pred = predict(model1, newdata = new_beeHive, type = "response")

RVScalePred = ggplot() +
  geom_point(data = beeHive, aes(x = width, y = parasites), 
             colour = "gold2") +
  geom_point(data = new_beeHive, aes(x = width, y = pred),
             colour = "darkmagenta")

ggarrange(LinPred, OddsPred, RVScalePred, 
          ncol = 2, nrow = 2, 
          labels = c("Linear Scale", "Odds Scale", "Data Scale"),
          colour = "red")
```

The model for the Data Scale:

$\pi$$_{i}$ $=$ $\frac{e^{-11.25 + 2.22^*Width}}{1 + e^{-11.25^+2.22^*Width}}$

So, let's say that we measured a 5mm wide cell, the chance of success of there being a parasite is:

$\pi$$_{i}$ $=$ $\frac{e^{(-11.25 + 2.22^*5)}}{1 + e^{-11.25^+2.22^*5}}$

$\pi$$_{i}$ $=$ $\frac{0.85}{1.85}$ $=$ 0.46

So there would be a 46% chance of there being an ectoparasite.

If the cell were 6mm the chance would increase to 0.89. 
